<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Game - Find the VULNERABILITY Word</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    * {
      box-sizing: border-box;
    }
    html {
      width: 100%;
      overflow-x: hidden;
    }
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #1e3a8a 0%, #312e81 15%, #4c1d95 30%, #7c3aed 45%, #1e40af 60%, #6366f1 75%, #8b5cf6 90%, #ec4899 100%);
      background-size: 400% 400%;
      animation: aurora 20s ease-in-out infinite;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      width: 100%;
      overflow-x: hidden;
    }
    .container {
      padding: 16px;
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
    }
    h1 { 
      text-align: center; 
      margin-top: 10px;
      font-size: 32px;
      color: #ffffff;
      font-weight: 700;
      text-shadow: 
        0 2px 12px rgba(0,0,0,0.4),
        0 0 20px rgba(96, 165, 250, 0.4),
        0 0 30px rgba(139, 92, 246, 0.35),
        0 0 40px rgba(236, 72, 153, 0.25),
        0 0 50px rgba(34, 197, 94, 0.2);
      animation: titleFadeIn 0.8s ease forwards, titleGlow 4s ease-in-out infinite;
    }
    .game-layout {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
      width: 100%;
      box-sizing: border-box;
    }
    /* Desktop view - ensure proper alignment */
    @media (min-width: 992px) {
      .game-layout {
        justify-content: flex-start;
        align-items: center;
        gap: 30px;
      }
      .puzzle {
        flex: 0 1 50%;
        max-width: 50%;
      }
      .panel {
        flex: 0 0 auto;
        width: 340px;
        align-self: center;
      }
    }
    /* Ensure desktop layout works on mobile when requesting desktop site */
    @media (min-width: 576px) {
      .game-layout {
        flex-wrap: nowrap;
      }
      .container {
        padding: 16px;
        max-width: 100%;
      }
    }
    .puzzle {
      flex: 1 1 48%;
      min-width: 400px;
      max-width: 50%;
      animation: floatY 4s ease-in-out infinite;
      box-sizing: border-box;
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    /* Mobile: allow overflow for zoomed image but prevent page scroll */
    @media (max-width: 991px) {
      .puzzle {
        overflow: visible !important;
        position: relative;
        touch-action: none !important;
        -webkit-overflow-scrolling: touch;
      }
      .puzzle img {
        will-change: transform;
        position: relative;
        z-index: 10;
        touch-action: none !important;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        touch-action: pan-y;
        overflow-x: hidden;
        position: relative;
      }
    }
    .puzzle img {
      display: block;
      width: 100%;
      min-height: 420px;
      max-height: 520px;
      object-fit: cover;
      border-radius: 24px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.55);
      transition: filter 0.6s ease, box-shadow 0.6s ease;
      animation: imageFadeIn 0.8s ease forwards;
      transform-origin: center center;
      touch-action: none !important;
      -webkit-touch-callout: none !important;
      -webkit-user-select: none !important;
      user-select: none !important;
      -webkit-user-drag: none !important;
      -webkit-tap-highlight-color: transparent !important;
      pointer-events: auto !important;
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      will-change: transform;
    }
    /* Desktop view on tablets (768px-1024px) - when user requests desktop site */
    @media (min-width: 768px) and (max-width: 1024px) {
      .game-layout {
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        justify-content: flex-start !important;
        align-items: center !important;
        gap: 18px;
      }
      .puzzle {
        flex: 0 1 55% !important;
        max-width: 55% !important;
        min-width: 350px !important;
        width: auto !important;
      }
      .puzzle img {
        min-height: 520px !important;
        max-height: 680px !important;
        object-fit: contain !important;
      }
      .panel {
        flex: 0 0 auto !important;
        width: 320px !important;
        max-width: 42% !important;
        min-width: 280px !important;
        align-self: center !important;
      }
    }
    /* Desktop view on mobile (576px-767px) - when user requests desktop site */
    @media (min-width: 576px) and (max-width: 767px) {
      .game-layout {
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        justify-content: flex-start !important;
        align-items: center !important;
        gap: 12px;
      }
      .puzzle {
        flex: 0 1 52% !important;
        max-width: 52% !important;
        min-width: 280px !important;
        width: auto !important;
      }
      .puzzle img {
        min-height: 480px !important;
        max-height: 620px !important;
        object-fit: contain !important;
      }
      .panel {
        flex: 0 0 auto !important;
        width: 280px !important;
        max-width: 45% !important;
        min-width: 250px !important;
        padding: 20px 22px !important;
        align-self: center !important;
      }
      .container {
        padding: 12px !important;
      }
      h1 {
        font-size: 24px !important;
      }
    }
    .puzzle:hover img {
      box-shadow: 
        0 30px 70px rgba(0,0,0,0.65), 
        0 0 30px rgba(59, 130, 246, 0.2), 
        0 0 50px rgba(139, 92, 246, 0.3),
        0 0 70px rgba(236, 72, 153, 0.2),
        0 0 90px rgba(34, 197, 94, 0.15);
      filter: brightness(1.08);
    }
    /* Fullscreen styles - make image much bigger */
    :fullscreen .puzzle,
    body.fullscreen-active .puzzle {
      flex: 1 1 70%;
      max-width: 70%;
      min-width: 600px;
    }
    :fullscreen .puzzle img,
    body.fullscreen-active .puzzle img {
      width: 100%;
      height: 100%;
      max-height: none;
      min-height: auto;
      object-fit: contain;
    }
    :fullscreen .panel,
    body.fullscreen-active .panel {
      flex: 1 1 28%;
      max-width: 28%;
    }
    :fullscreen .game-layout,
    body.fullscreen-active .game-layout {
      max-width: 95%;
      margin: 20px auto;
    }
    :fullscreen .container,
    body.fullscreen-active .container {
      padding: 20px;
      max-width: 100%;
    }
    .panel {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96) 0%, rgba(30, 41, 59, 0.94) 25%, rgba(51, 65, 85, 0.92) 50%, rgba(30, 41, 59, 0.94) 75%, rgba(15, 23, 42, 0.96) 100%);
      padding: 24px 28px;
      border-radius: 20px;
      width: 340px;
      max-width: 100%;
      box-sizing: border-box;
      flex-shrink: 0;
      box-shadow: 0 30px 80px rgba(0,0,0,0.85), 0 0 40px rgba(59, 130, 246, 0.15), 0 0 60px rgba(139, 92, 246, 0.2), 0 0 80px rgba(236, 72, 153, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(148,163,184,0.3);
      border-top-color: rgba(59, 130, 246, 0.4);
      border-right-color: rgba(139, 92, 246, 0.4);
      border-bottom-color: rgba(236, 72, 153, 0.3);
      border-left-color: rgba(59, 130, 246, 0.4);
      transform: translateY(20px);
      opacity: 0;
      animation: riseIn 0.8s ease forwards 0.3s;
      position: relative;
      overflow: hidden;
      align-self: center;
    }
    .panel::before,
    .panel::after {
      content: "";
      position: absolute;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      filter: blur(5px);
      opacity: 0.85;
      pointer-events: none;
      animation: orbDrift 9s linear infinite;
    }
    .panel::before {
      top: -50px;
      right: -40px;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.35), rgba(236, 72, 153, 0.25), rgba(59,130,246,0.2), transparent 75%);
    }
    .panel::after {
      bottom: -60px;
      left: -30px;
      animation-delay: -4s;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.35), rgba(34, 197, 94, 0.25), rgba(139, 92, 246, 0.2), transparent 75%);
    }
    .level-label {
      margin: 6px 0 10px;
      font-size: 16px;
      font-weight: 600;
      color: #fcd34d;
      text-shadow: 
        0 2px 8px rgba(252, 211, 77, 0.4),
        0 0 15px rgba(236, 72, 153, 0.3),
        0 0 20px rgba(139, 92, 246, 0.25);
      animation: fadeInLabel 0.6s ease forwards, labelGlow 3s ease-in-out infinite;
    }
    .levels-indicator {
      display: flex !important;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
      visibility: visible !important;
      opacity: 1 !important;
      min-height: 30px;
    }
    .level-chip {
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.3);
      color: #e5e7eb;
      background: rgba(255,255,255,0.08);
      min-width: 60px;
      text-align: center;
    }
    .level-chip.completed {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(16,185,129,0.2));
      border-color: rgba(34,197,94,0.7);
      color: #bbf7d0;
      box-shadow: 0 4px 12px rgba(34,197,94,0.3);
    }
    .level-chip.active {
      background: linear-gradient(135deg, rgba(59,130,246,0.35), rgba(139,92,246,0.3), rgba(236,72,153,0.2));
      border-color: rgba(59,130,246,0.9);
      color: #bfdbfe;
      box-shadow: 0 8px 20px rgba(59,130,246,0.26), 0 0 15px rgba(139, 92, 246, 0.3), 0 0 25px rgba(236, 72, 153, 0.2);
      animation: chipPulse 2.8s ease-in-out infinite;
    }
    .level-chip.locked {
      opacity: 0.45;
    }
    label { 
      font-size: 14px; 
      display: block; 
      margin-top: 8px;
      color: #cbd5e1;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    label:hover {
      color: #e2e8f0;
    }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(148,163,184,0.25);
      background: rgba(30, 41, 59, 0.7);
      color: #ffffff;
      margin-top: 4px;
      font-size: 14px;
      box-sizing: border-box;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    input:nth-of-type(1) {
      border-left: 3px solid rgba(59, 130, 246, 0.5);
    }
    input:nth-of-type(2) {
      border-left: 3px solid rgba(139, 92, 246, 0.5);
    }
    input:nth-of-type(3) {
      border-left: 3px solid rgba(236, 72, 153, 0.5);
    }
    input:nth-of-type(4) {
      border-left: 3px solid rgba(34, 197, 94, 0.5);
    }
    input:hover {
      background: rgba(30, 41, 59, 0.85);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.15);
    }
    input:nth-of-type(1):hover {
      border-left-color: rgba(59, 130, 246, 0.8);
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.2);
    }
    input:nth-of-type(2):hover {
      border-left-color: rgba(139, 92, 246, 0.8);
      box-shadow: 0 0 12px rgba(139, 92, 246, 0.2);
    }
    input:nth-of-type(3):hover {
      border-left-color: rgba(236, 72, 153, 0.8);
      box-shadow: 0 0 12px rgba(236, 72, 153, 0.2);
    }
    input:nth-of-type(4):hover {
      border-left-color: rgba(34, 197, 94, 0.8);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.2);
    }
    button {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin-top: 12px;
      font-size: 15px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease;
    }
    .btn-secondary {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
      color: #ffffff;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.35), 0 0 15px rgba(139, 92, 246, 0.2);
      padding: 8px 16px;
      margin: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 6px 16px rgba(99, 102, 241, 0.5),
        0 0 20px rgba(139, 92, 246, 0.3),
        0 0 30px rgba(236, 72, 153, 0.25);
      filter: brightness(1.1);
    }
    .btn-primary { 
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 20%, #8b5cf6 40%, #ec4899 60%, #6366f1 80%, #3b82f6 100%);
      background-size: 200% 200%;
      animation: gradientShift 4s ease infinite;
      color: #ffffff; 
      width: 100%; 
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.45), 0 0 20px rgba(139, 92, 246, 0.25), 0 0 30px rgba(236, 72, 153, 0.15);
      font-weight: 600;
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-primary::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.35), transparent);
      transform: translateX(-120%) skewX(-20deg);
      animation: buttonSheen 3.5s infinite;
    }
    .btn-primary:hover {
      transform: translateY(-3px) scale(1.01);
      box-shadow: 
        0 12px 32px rgba(37, 99, 235, 0.55), 
        0 4px 12px rgba(96, 165, 250, 0.3), 
        0 0 25px rgba(139, 92, 246, 0.4),
        0 0 35px rgba(236, 72, 153, 0.3),
        0 0 45px rgba(34, 197, 94, 0.2);
      filter: brightness(1.15);
    }
    .timer { 
      margin-top: 8px; 
      font-size: 14px; 
      font-weight: bold;
      color: #ffffff;
      text-shadow: 
        0 0 8px rgba(56,189,248,0.5),
        0 0 12px rgba(139, 92, 246, 0.3),
        0 0 16px rgba(236, 72, 153, 0.2);
    }
    .msg { 
      margin-top: 8px; 
      min-height: 18px; 
      font-size: 14px;
      font-weight: 500;
    }
    .error { color: #fca5a5; }
    .success { color: #86efac; }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    .small { 
      font-size: 12px; 
      color: #d1d5db; 
    }
    .timer span {
      display: inline-block;
      min-width: 60px;
      text-align: right;
      animation: glow 2s ease-in-out infinite;
    } 
    @keyframes aurora {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    input:focus {
      outline: none;
      background: rgba(30, 41, 59, 0.95);
      transform: translateY(-1px);
    }
    input:nth-of-type(1):focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25), 0 4px 12px rgba(59, 130, 246, 0.2), 0 0 20px rgba(59, 130, 246, 0.3);
    }
    input:nth-of-type(2):focus {
      border-color: #a78bfa;
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.25), 0 4px 12px rgba(139, 92, 246, 0.2), 0 0 20px rgba(139, 92, 246, 0.3);
    }
    input:nth-of-type(3):focus {
      border-color: #f472b6;
      box-shadow: 0 0 0 3px rgba(244, 114, 182, 0.25), 0 4px 12px rgba(236, 72, 153, 0.2), 0 0 20px rgba(236, 72, 153, 0.3);
    }
    input:nth-of-type(4):focus {
      border-color: #4ade80;
      box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.25), 0 4px 12px rgba(34, 197, 94, 0.2), 0 0 20px rgba(34, 197, 94, 0.3);
    }
    @keyframes floatY {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }
    @keyframes riseIn {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes glow {
      0%, 100% { 
        text-shadow: 
          0 0 6px rgba(56,189,248,0.5), 
          0 0 10px rgba(139, 92, 246, 0.3),
          0 0 14px rgba(236, 72, 153, 0.2); 
        color: #f8fafc; 
      }
      50% { 
        text-shadow: 
          0 0 14px rgba(56,189,248,0.9), 
          0 0 20px rgba(139, 92, 246, 0.5),
          0 0 25px rgba(236, 72, 153, 0.4),
          0 0 30px rgba(34, 197, 94, 0.3); 
        color: #bae6fd; 
      }
    }
    @keyframes orbDrift {
      0% { transform: translate3d(0,0,0) scale(0.95); opacity: 0.35; }
      50% { transform: translate3d(18px,-14px,0) scale(1.1); opacity: 0.75; }
      100% { transform: translate3d(0,0,0) scale(0.95); opacity: 0.35; }
    }
    @keyframes chipPulse {
      0%,100% { 
        box-shadow: 
          0 8px 20px rgba(59,130,246,0.25), 
          0 0 12px rgba(139, 92, 246, 0.2),
          0 0 18px rgba(236, 72, 153, 0.15); 
        transform: translateY(0); 
      }
      50% { 
        box-shadow: 
          0 12px 26px rgba(59,130,246,0.45), 
          0 0 18px rgba(139, 92, 246, 0.35),
          0 0 25px rgba(236, 72, 153, 0.3),
          0 0 30px rgba(34, 197, 94, 0.2); 
        transform: translateY(-2px); 
      }
    }
    @keyframes buttonSheen {
      0% { transform: translateX(-120%) skewX(-20deg); }
      60% { transform: translateX(120%) skewX(-20deg); }
      100% { transform: translateX(120%) skewX(-20deg); }
    }
    @keyframes fadeInLabel {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes imageFadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes titleFadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes titleGlow {
      0%, 100% {
        text-shadow: 
          0 2px 12px rgba(0,0,0,0.4),
          0 0 20px rgba(96, 165, 250, 0.4),
          0 0 30px rgba(139, 92, 246, 0.35),
          0 0 40px rgba(236, 72, 153, 0.25);
      }
      50% {
        text-shadow: 
          0 2px 12px rgba(0,0,0,0.4),
          0 0 25px rgba(96, 165, 250, 0.5),
          0 0 40px rgba(139, 92, 246, 0.45),
          0 0 50px rgba(236, 72, 153, 0.35),
          0 0 60px rgba(34, 197, 94, 0.3);
      }
    }
    @keyframes labelGlow {
      0%, 100% {
        text-shadow: 
          0 2px 8px rgba(252, 211, 77, 0.4),
          0 0 15px rgba(236, 72, 153, 0.3),
          0 0 20px rgba(139, 92, 246, 0.25);
      }
      50% {
        text-shadow: 
          0 2px 8px rgba(252, 211, 77, 0.5),
          0 0 20px rgba(236, 72, 153, 0.4),
          0 0 25px rgba(139, 92, 246, 0.35),
          0 0 30px rgba(59, 130, 246, 0.3);
      }
    }

    /* ========== RESPONSIVE DESIGN - 100% PERFECT ========== */
    
    /* Large Desktop / 4K (1920px and above) */
    @media (min-width: 1920px) {
      .container {
        max-width: 1800px;
        margin: 0 auto;
        padding: 24px;
      }
      .game-layout {
        gap: 50px;
        max-width: 100%;
      }
      .puzzle {
        flex: 1 1 50%;
        min-width: 500px;
        max-width: 50%;
      }
      .puzzle img {
        min-height: 500px;
        max-height: 600px;
      }
      .panel {
        width: 400px;
        padding: 32px 36px;
        max-width: 100%;
      }
      h1 {
        font-size: 36px;
      }
    }

    /* Desktop / Laptop (1200px to 1919px) */
    @media (min-width: 1200px) and (max-width: 1919px) {
      .container {
        padding: 20px;
        max-width: 100%;
      }
      .game-layout {
        gap: 35px;
        max-width: 100%;
      }
      .puzzle {
        flex: 1 1 48%;
        min-width: 450px;
        max-width: 50%;
      }
      .puzzle img {
        min-height: 450px;
        max-height: 550px;
      }
      .panel {
        width: 360px;
        padding: 28px 32px;
        max-width: 100%;
      }
      h1 {
        font-size: 32px;
      }
    }

    /* Laptop / Small Desktop (992px to 1199px) */
    @media (min-width: 992px) and (max-width: 1199px) {
      .container {
        padding: 16px;
      }
      .game-layout {
        gap: 28px;
      }
      .puzzle {
        flex: 1 1 48%;
        min-width: 400px;
        max-width: 50%;
      }
      .puzzle img {
        min-height: 400px;
        max-height: 500px;
      }
      .panel {
        width: 340px;
        padding: 24px 28px;
        max-width: 100%;
      }
      h1 {
        font-size: 28px;
      }
      .level-label {
        font-size: 15px;
      }
    }

    /* Tablet Landscape (768px to 991px) */
    @media (min-width: 768px) and (max-width: 991px) {
      .container {
        padding: 12px;
      }
      .game-layout {
        flex-direction: column;
        align-items: center;
        gap: 24px;
        width: 100%;
      }
      .puzzle {
        flex: 1 1 100%;
        min-width: 100%;
        max-width: 100%;
        width: 100%;
      }
      .puzzle img {
        min-height: 350px;
        max-height: 450px;
        width: 100%;
      }
      .panel {
        width: 100%;
        max-width: 600px;
        padding: 24px 28px;
      }
      h1 {
        font-size: 26px;
        margin-top: 8px;
      }
      .level-label {
        font-size: 15px;
      }
      .levels-indicator {
        gap: 10px;
      }
      .level-chip {
        padding: 6px 12px;
        font-size: 13px;
      }
    }

    /* Mobile Landscape / Large Mobile (576px to 767px) - Mobile View */
    @media (min-width: 576px) and (max-width: 767px) {
      .container {
        padding: 10px;
        width: 100%;
        box-sizing: border-box;
      }
      .game-layout {
        flex-direction: column;
        gap: 20px;
        margin-top: 15px;
        width: 100%;
      }
      .puzzle {
        flex: 1 1 100%;
        min-width: 100%;
        max-width: 100%;
        width: 100%;
      }
      .puzzle img {
        min-height: 280px;
        max-height: 380px;
        border-radius: 16px;
        width: 100%;
      }
      .panel {
        width: 100%;
        max-width: 100%;
        padding: 20px 24px;
        border-radius: 16px;
        box-sizing: border-box;
      }
      h1 {
        font-size: 24px;
        margin-top: 5px;
        padding: 0 10px;
      }
      .level-label {
        font-size: 15px;
        margin: 6px 0 10px;
      }
      .levels-indicator {
        gap: 8px;
        margin-bottom: 12px;
      }
      .level-chip {
        padding: 5px 12px;
        font-size: 13px;
        min-width: 55px;
      }
      label {
        font-size: 14px;
        margin-top: 8px;
      }
      input {
        padding: 12px;
        font-size: 16px; /* Prevents zoom on iOS */
        min-height: 44px; /* Better touch target */
        box-sizing: border-box;
      }
      button {
        padding: 14px 18px;
        font-size: 16px;
        min-height: 48px; /* Better touch target */
      }
      .btn-secondary {
        padding: 8px 14px;
        font-size: 14px;
        min-height: 40px;
      }
      .top-bar {
        gap: 8px;
        flex-wrap: wrap;
      }
      .timer {
        font-size: 14px;
      }
      .msg {
        font-size: 14px;
        min-height: 20px;
      }
    }

    /* Mobile Portrait (up to 575px) */
    @media (max-width: 575px) {
      * {
        box-sizing: border-box;
      }
      .container {
        padding: 8px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      .game-layout {
        flex-direction: column;
        gap: 16px;
        margin-top: 12px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      .puzzle {
        flex: 1 1 100%;
        min-width: 100%;
        max-width: 100%;
        width: 100%;
        position: relative;
        overflow: hidden;
        box-sizing: border-box;
      }
      .puzzle img {
        min-height: 400px;
        max-height: 600px;
        border-radius: 12px;
        width: 100%;
        max-width: 100%;
        height: auto;
        object-fit: contain;
        display: block;
      }
      .panel {
        width: 100%;
        max-width: 100%;
        padding: 18px 20px;
        border-radius: 16px;
        box-sizing: border-box;
        margin: 0;
      }
      .panel::before,
      .panel::after {
        width: 80px;
        height: 80px;
      }
      h1 {
        font-size: 20px;
        margin-top: 5px;
        padding: 0 8px;
        text-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 15px rgba(96, 165, 250, 0.2);
      }
      .level-label {
        font-size: 14px;
        margin: 4px 0 8px;
      }
      .levels-indicator {
        gap: 8px;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }
      .level-chip {
        padding: 5px 10px;
        font-size: 12px;
        min-width: 50px;
      }
      label {
        font-size: 13px;
        margin-top: 6px;
      }
      input {
        padding: 12px;
        font-size: 16px; /* Prevents zoom on iOS */
        border-radius: 6px;
        margin-top: 4px;
        min-height: 44px; /* Better touch target */
        box-sizing: border-box;
      }
      button {
        padding: 14px 16px;
        font-size: 16px;
        margin-top: 10px;
        min-height: 48px; /* Better touch target */
        width: 100%;
      }
      .btn-secondary {
        padding: 8px 12px;
        font-size: 13px;
        min-height: 40px;
      }
      .top-bar {
        gap: 6px;
        flex-wrap: wrap;
        padding: 0 4px;
      }
      .timer {
        font-size: 13px;
      }
      .timer span {
        min-width: 50px;
      }
      .msg {
        font-size: 13px;
        min-height: 18px;
        line-height: 1.4;
      }
      #start-overlay h2 {
        font-size: 22px;
        margin-bottom: 8px;
        padding: 0 16px;
      }
      #start-overlay p {
        font-size: 13px;
        padding: 0 16px;
        line-height: 1.5;
      }
    }

    /* Start Overlay Responsive Styles */
    #start-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.96);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      cursor: pointer;
      pointer-events: auto;
      padding: 20px;
      box-sizing: border-box;
    }
    #start-overlay h2 {
      margin: 0 0 10px;
      font-size: 26px;
      pointer-events: none;
      user-select: none;
      text-align: center;
      color: #ffffff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    #start-overlay p {
      margin: 0;
      font-size: 14px;
      color: #e5e7eb;
      max-width: 420px;
      text-align: center;
      pointer-events: none;
      user-select: none;
      line-height: 1.6;
    }
    @media (max-width: 767px) {
      #start-overlay {
        padding: 16px;
      }
      #start-overlay h2 {
        font-size: 22px;
        margin-bottom: 8px;
        padding: 0 16px;
      }
      #start-overlay p {
        font-size: 13px;
        padding: 0 16px;
        max-width: 100%;
      }
    }
    @media (max-width: 575px) {
      #start-overlay {
        padding: 12px;
      }
      #start-overlay h2 {
        font-size: 20px;
        margin-bottom: 6px;
        padding: 0 12px;
      }
      #start-overlay p {
        font-size: 12px;
        padding: 0 12px;
        line-height: 1.5;
      }
    }
    @media (max-width: 375px) {
      #start-overlay h2 {
        font-size: 18px;
      }
      #start-overlay p {
        font-size: 11px;
      }
    }
    @media (max-width: 991px) and (orientation: landscape) {
      #start-overlay {
        padding: 10px;
      }
      #start-overlay h2 {
        font-size: 20px;
        margin-bottom: 6px;
      }
      #start-overlay p {
        font-size: 12px;
        max-width: 90%;
      }
    }

    /* Extra Small Mobile (up to 375px) */
    @media (max-width: 375px) {
      .container {
        padding: 6px;
      }
      .puzzle img {
        min-height: 350px;
        max-height: 500px;
      }
      .panel {
        padding: 16px 18px;
      }
      h1 {
        font-size: 18px;
        padding: 0 6px;
      }
      input {
        padding: 10px;
        font-size: 16px;
      }
      button {
        padding: 12px 14px;
        font-size: 15px;
      }
    }
    @media (max-width: 375px) {
      .container {
        padding: 6px;
      }
      h1 {
        font-size: 18px;
        padding: 0 6px;
      }
      .puzzle img {
        min-height: 350px;
        max-height: 500px;
      }
      .panel {
        padding: 16px 18px;
      }
      .level-chip {
        padding: 4px 8px;
        font-size: 11px;
        min-width: 45px;
      }
      input {
        padding: 10px;
        font-size: 16px;
      }
      button {
        padding: 12px 14px;
        font-size: 15px;
      }
      .btn-secondary {
        padding: 7px 10px;
        font-size: 12px;
      }
    }

    /* Extra Extra Small Mobile (up to 320px) */
    @media (max-width: 320px) {
      .container {
        padding: 4px;
      }
      h1 {
        font-size: 16px;
        padding: 0 4px;
      }
      .level-chip {
        padding: 3px 6px;
        font-size: 10px;
        min-width: 40px;
      }
      input {
        padding: 10px;
        font-size: 16px;
        min-height: 42px;
      }
      button {
        padding: 11px 12px;
        font-size: 14px;
        min-height: 44px;
      }
      .btn-secondary {
        padding: 6px 8px;
        font-size: 11px;
        min-height: 36px;
      }
      .puzzle img {
        min-height: 180px;
        max-height: 250px;
      }
      .panel {
        padding: 14px 16px;
      }
      .level-chip {
        padding: 4px 6px;
        font-size: 10px;
        min-width: 40px;
      }
      label {
        font-size: 12px;
      }
      input {
        padding: 10px;
        font-size: 16px;
      }
      button {
        padding: 12px;
        font-size: 14px;
      }
    }

    /* Fullscreen Responsive Adjustments */
    @media (max-width: 991px) {
      :fullscreen .puzzle,
      body.fullscreen-active .puzzle {
        flex: 1 1 100%;
        max-width: 100%;
        min-width: 100%;
        width: 100%;
      }
      :fullscreen .puzzle img,
      body.fullscreen-active .puzzle img {
        width: 100%;
        height: auto;
        max-height: 60vh;
        object-fit: contain;
      }
      :fullscreen .panel,
      body.fullscreen-active .panel {
        flex: 1 1 100%;
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
      }
      :fullscreen .game-layout,
      body.fullscreen-active .game-layout {
        flex-direction: column;
        width: 100%;
        gap: 20px;
      }
      :fullscreen .container,
      body.fullscreen-active .container {
        padding: 12px;
        width: 100%;
        max-width: 100%;
      }
    }

    /* Touch Device Optimizations */
    @media (hover: none) and (pointer: coarse) {
      .puzzle:hover img {
        filter: brightness(1);
        box-shadow: 0 25px 60px rgba(0,0,0,0.55);
      }
      input:hover {
        border-color: rgba(148,163,184,0.25);
        box-shadow: none;
        background: rgba(30, 41, 59, 0.7);
      }
      input:focus {
        background: rgba(30, 41, 59, 0.85);
        box-shadow: 0 0 10px rgba(139, 92, 246, 0.15);
      }
      .btn-primary:hover {
        transform: translateY(0) scale(1);
      }
      .btn-primary:active {
        transform: translateY(1px) scale(0.98);
      }
      button:hover {
        transform: translateY(0);
      }
      button:active {
        transform: translateY(1px) scale(0.98);
      }
      label:hover {
        color: #cbd5e1;
      }
      /* Better touch targets */
      input, button, .btn-secondary {
        -webkit-tap-highlight-color: rgba(139, 92, 246, 0.3);
      }
    }

    /* Landscape Orientation Adjustments for Mobile */
    @media (max-width: 991px) and (orientation: landscape) {
      .container {
        padding: 8px;
      }
      .game-layout {
        flex-direction: row;
        gap: 16px;
        align-items: center;
      }
      .puzzle {
        flex: 1 1 55%;
        min-width: 0;
        max-width: 55%;
      }
      .puzzle img {
        min-height: 250px;
        max-height: 400px;
        width: 100%;
        object-fit: contain;
      }
      .panel {
        flex: 1 1 45%;
        max-width: 45%;
        padding: 16px 20px;
        align-self: center;
      }
      h1 {
        font-size: 22px;
        margin-top: 3px;
      }
      .level-label {
        font-size: 14px;
        margin: 4px 0 6px;
      }
      .levels-indicator {
        gap: 6px;
        margin-bottom: 10px;
      }
      .level-chip {
        padding: 4px 8px;
        font-size: 11px;
      }
      label {
        font-size: 12px;
        margin-top: 4px;
      }
      input {
        padding: 8px;
        font-size: 14px;
        min-height: 36px;
      }
      button {
        padding: 10px 14px;
        font-size: 14px;
        min-height: 40px;
        margin-top: 8px;
      }
      .btn-secondary {
        padding: 6px 10px;
        font-size: 12px;
        min-height: 32px;
      }
    }

    /* Very Small Landscape (up to 767px landscape) */
    @media (max-width: 767px) and (orientation: landscape) {
      .puzzle img {
        min-height: 200px;
        max-height: 350px;
        object-fit: contain;
      }
      .panel {
        padding: 14px 18px;
      }
      h1 {
        font-size: 20px;
      }
      .game-layout {
        align-items: center;
      }
      .panel {
        align-self: center;
      }
    }
    /* Ensure no horizontal scroll on any device */
    @media (max-width: 991px) {
      body, html {
        overflow-x: hidden;
        max-width: 100vw;
      }
      .container {
        max-width: 100%;
        overflow-x: hidden;
      }
      .game-layout {
        max-width: 100%;
        overflow-x: hidden;
      }
      .puzzle, .panel {
        max-width: 100%;
        overflow-x: hidden;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <h1>Find the VULNERABILITY Word</h1>
      <button class="btn-secondary" onclick="quitGame()">Quit</button>
    </div>
    <p class="small"></p>

    <div class="game-layout">
      <div class="puzzle">
        <!-- Replace with your real puzzle image -->
        <img id="puzzle-image" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqIzBL5VzekQmzg_96JhXXnra8CbntI83jG1PcA349_mB5l5iuNUw7uElJBw_gcrcCYZ8&usqp=CAU" alt="Puzzle" />
      </div>

      <div class="panel">
        <p class="timer">Time: <span id="timer">0.00</span> seconds</p>
        <p class="level-label">Level: <span id="level-name">Easy</span></p>
        <div class="levels-indicator" id="level-progress"></div>

        <label for="answer1">Answer 1</label>
        <input id="answer1" type="text" placeholder="Enter first answer" />

        <label for="answer2">Answer 2</label>
        <input id="answer2" type="text" placeholder="Enter second answer" />

        <label for="answer3">Answer 3</label>
        <input id="answer3" type="text" placeholder="Enter third answer" />

        <label for="answer4">Answer 4</label>
        <input id="answer4" type="text" placeholder="Enter fourth answer" />

        <button class="btn-primary" id="submit-btn" disabled>Submit Answers</button>

        <div class="msg" id="msg"></div>
      </div>
    </div>

    <!-- Fullscreen / start overlay -->
    <div id="start-overlay">
      <h2>Click to Start Game</h2>
      <p>Click anywhere on this screen. The game will go fullscreen and the timer will start automatically.</p>
    </div>
    <script>
      // Immediate click handler - works before main script loads
      (function() {
        const overlay = document.getElementById("start-overlay");
        if (overlay) {
          function handleStart(e) {
            e.preventDefault();
            e.stopPropagation();
            overlay.style.display = "none";
            // Trigger the main start function when available
            if (window.startGameNow) {
              window.startGameNow(e);
            } else {
              // Wait for main script to load
              const checkInterval = setInterval(function() {
                if (window.startGameNow) {
                  clearInterval(checkInterval);
                  window.startGameNow(e);
                }
              }, 50);
              // Timeout after 2 seconds
              setTimeout(function() {
                clearInterval(checkInterval);
                if (window.startGameNow) {
                  window.startGameNow(e);
                }
              }, 2000);
            }
            return false;
          }
          overlay.addEventListener("click", handleStart);
          overlay.addEventListener("touchstart", handleStart);
        }
      })();
    </script>
  </div>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>

    // Level definitions
    const LEVELS = [
      { 
        name: "Easy", 
        words:["Id card","I'd card","Face","Identity card","Atm card","Staff card","Employee id","Photo id","Office id","Work badge","Company id","Id badge","Name card","Badge card","Office badge","Work id","Security id","Identity badge","Staff badge","Profile card","Work pass","Access card","Identity pass","Company badge","Personal id","Staff pass","Id pass","Login card","Member id","Member card","Office pass","Identity paper","Id details","Staff details","Office details","Work details","User badge","Entry card","Entry pass","Id paper","Company pass","Staff identity","Work identity","Identity proof","Official id","Corporate id","Business id","Staff profile","Work profile","Id document","Otp","Otp on mobile","Mobile otp","Mobile","Phone otp","Sms otp","Otp code","One time","Time code","Verification otp","Secure otp","Login otp","Message otp","Otp message","Otp number","Code number","Otp digit","Phone code","Mobile code","Device otp","Otp alert","Otp text","Text otp","Otp screen","Otp popup","Otp box","Otp display","Otp pin","Mobile pin","Phone pin","Auth otp","Otp auth","Two step","Otp check","Otp verify","Verify code","Otp token","Mobile token","Phone token","Otp pass","Login code","Access code","Otp login","Otp passcode","Otp secure","Security code","Otp security","Otp lock","Phone lock","Otp input","Http","Unsecured website","Website","Unsafe site","Fake site","Bad website","Suspicious site","Not secure","Unsecure page","Warning site","Red flag","Risk site","Phishing page","Danger page","Malware site","Fake login","Spam page","Spam site","Risky page","Risky site","Unsafe login","Http website","Http page","No lock","No https","Broken lock","Unsafe browser","Bad page","Fake page","Warning page","Alert site","Not safe","Unsafe url","Fake url","Suspicious url","Phishing url","Danger url","Risk url","Bad url","Broken site","Blocked page","Browser alert","Fraud site","Fraud page","Malware page","Virus site","Red alert","Unsafe network","Warning url","Click here to claim","Claim prize","You won 10000","Fake website","Fake prize","Prize scam","Click prize","Win prize","Fake win","Scam win","Prize alert","Prize popup","Fake popup","Scam popup","Fake offer","Prize offer","Fake reward","Reward scam","Winning scam","Lucky draw","Fake draw","Spam prize","Spam win","Prize page","Fake message","Scam message","Prize link","Fake link","Scam link","Click win","Prize claim","Fake claim","Scam claim","Lucky prize","Fake gift","Gift scam","Reward page","Winning page","Claim page","Prize scam page","Prize fraud","Fake fraud","Scam reward","False prize","False win","Prize trick","Scam trick","Fraud win","Prize notification","Scam alert"],

        image: "EASY.png"
      },
      {
        name: "Medium", 
        words:["Software outdated","Update required","Old version","Outdated app","Broken update","System update","Expired version","Old software","App update","Patch needed","No update","Old patch","System lag","Bug issue","Crash app","Slow software","Error screen","Faulty app","Device update","Missing patch","Update alert","System error","Update popup","Unsafe version","Weak software","Corrupt files","Glitch app","Patch error","System weak","App lag","Outdated tool","Security patch","Weak version","App error","System crash","Old system","Update fix","App patch","Version error","Patch alert","App warning","Software fault","System warning","App broken","Update fail","Software bug","Old build","Bug fix","Device error","Expired software","User name","Password","Login page","Login info","Login pass","User login","Pass code","Secure login","Login form","Login box","User pass","Account login","Login id","User entry","Account entry","Pass entry","Login check","Login access","User access","Pass access","Login attempt","Login fail","Pass wrong","Wrong password","User wrong","Login error","Login alert","Pass reset","User reset","Secure entry","Account verify","Login verify","Pass verify","User verify","Access denied","Access block","User block","Pass block","Login code","Secure code","Login token","User token","Pass token","Login key","Password key","User key","Access key","Account key","Secure pass","Secure user","Webcam","Web camera","Camera on","Front camera","Back camera","Device camera","Live camera","Video cam","Capture cam","Cam active","Camera alert","Camera open","Open cam","Spy camera","Hidden cam","Fake cam","Camera view","Camera screen","Camera feed","Camera mode","Auto camera","Camera record","Record cam","Camera shot","Cam shot","Camera error","Cam warning","Security camera","Live feed","Camera scan","Qr camera","Phone camera","Laptop cam","Pc camera","System cam","Smart cam","Digital cam","Camera access","Camera request","View cam","Monitor cam","Watch cam","Active cam","Instant cam","Mini cam","Micro cam","Lens cam","Camera lens","Back cam","Front cam","Qr code","Qr","Scanner","Code","Scan code","Qr scan","Code scan","Secure qr","Fake qr","Qr link","Qr page","Qr site","Scan here","Quick scan","Fast scan","Barcode","Smart code","Digital code","Qr read","Read code","Code reader","Qr reader","Scan tool","Scan app","Code app","Qr box","Qr panel","Scan box","Qr access","Code access","Qr input","Scan input","Scan now","Code now","Qr entry","Code entry","Scan entry","Quick code","Instant code","Flash code","Mobile qr","Phone qr","Qr open","Qr check","Code check","Scan check","Secure scan","Link scan","Scan link"],
      
        image: "MEDIUM.png"
      },
      { 
        name: "Hard", 
        words:["Wifi","Wifi pass","Home1234","Wifi password home1234","Wifi:home1234","Wifi key","Wifi code","Wifi access","Wifi login","Wifi note","Wifi paper","Wifi text","Wifi write","Wifi detail","Wifi info","Wifi slip","Wifi tag","Wifi id","Wifi lock","Wifi connect","Wifi router","Wifi name","Wifi passcode","Wifi secret","Wifi doc","Wifi card","Wifi label","Wifi message","Wifi word","Wifi page","Wifi network","Wifi hotspot","Wifi setup","Wifi device","Wifi pin","Wifi number","Wifi line","Wifi book","Wifi entry","Wifi display","Wifi saved","Wifi list","Wifi highlight","Wifi point","Wifi marker","Wifi reminder","Wifi memo","Wifi pwd","Wifi notebook","Wifi detail page","Wifi","Public wifi","Wifi public","Open wifi","Free wifi","Shared wifi","Public net","Wifi zone","Wifi spot","Wifi area","Open hotspot","Hotspot public","Wifi shared","Wifi open","Wifi station","Public network","Network open","Wifi point","Wifi hub","Wifi connect","Public router","Open router","Wifi free","Net public","Wifi access","Wifi service","Public hotspot","Wifi unsecured","Wifi guest","Guest wifi","Public connection","Public net zone","Wifi link","Wifi local","Wifi city","Public broadband","Wifi free area","Wifi no password","Wifi common","Wifi area public","Town wifi","Public wifi point","Wifi street","Street wifi","Wifi building","Wifi open zone","Wifi share","Wifi local area","Common wifi","Open net","Personal information","Name","Name,name,address","Name name address","Personal data","User info","Private info","Identity info","Contact info","Home address","Address data","Phone info","User details","Sensitive info","Info sheet","Document info","Profile info","Bio data","Personal details","Name list","Address list","User name","Full name","Info page","Info paper","Data paper","User document","Paper info","Record info","Address paper","Name record","Identity record","User address","Info printed","Printed data","Private data","Data sheet","Profile data","Name info","Address info","User sheet","Paper detail","Detail info","Written info","Contact detail","Details printed","Info saved","Info shown","Info exposed","Personal sheet","Mobile alert","Mobile warning","Alert","Warning","Phone alert","Phone warning","System alert","System warning","Alert popup","Warning popup","Mobile pop","Phone pop","Alert message","Warning message","Mobile notice","Phone notice","Security alert","Security warning","App alert","App warning","Device alert","Device warning","Popup alert","Popup warning","Alert box","Warning box","Alert icon","Warning icon","Phone alert screen","Mobile alert screen","System popup","Mobile buzz","Phone buzz","Alert tone","Warning tone","Message alert","Notification alert","Notification warning","Alert signal","Warning signal","Alert display","Warning display","Alert banner","Warning banner","Emergency alert","Critical alert","Critical warning","Device popup","Mobile notification","Alert notification","Unsecure website","Website unsecure","Unsecured website","Unsafe website","Fake website","Bad site","Suspicious site","Phishy site","Phishing link","Untrusted site","Danger site","Not secure","Security risk","Risky site","Site alert","Warning site","Fake link","Scam site","Scam page","Unsecure page","Website unsafe","Website risky","Site unprotected","No https","Http site","Http page","Unknown site","Spoof site","Fraud site","Fake page","Malicious site","Malware page","Website danger","Suspicious link","Shady site","Unverified site","Rogue site","Compromised site","Risk page","Risk link","Fake domain","Bad domain","Unsafe domain","Unsecure server","Unsafe server","Site virus","Threat site","Threat page","Harmful site"],
      
        image: "HARD.png"
      }
    ];

    let startTime = null;
    let timerInterval = null;
    let gameRunning = false;
    // Controls whether leaving fullscreen is allowed (quit / navigation)
    let allowFullscreenExit = false;
    let currentLevelIndex = 0;
    let score = 0;
    let wrongCount = 0;
    let isSubmitting = false;

    // Pinch-to-zoom variables for mobile
    let imageZoom = 1;
    let imagePanX = 0;
    let imagePanY = 0;
    let isPinching = false;
    let lastPinchDistance = 0;
    let lastPinchCenterX = 0;
    let lastPinchCenterY = 0;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    const MIN_ZOOM = 1;
    const MAX_ZOOM = 4;

    const timerEl = document.getElementById("timer");
    const msgEl = document.getElementById("msg");
    const levelNameEl = document.getElementById("level-name");
    const levelProgressEl = document.getElementById("level-progress");
    const answer1Input = document.getElementById("answer1");
    const answer2Input = document.getElementById("answer2");
    const answer3Input = document.getElementById("answer3");
    const answer4Input = document.getElementById("answer4");
    const submitBtn = document.getElementById("submit-btn");
    const startOverlay = document.getElementById("start-overlay");


    // Read player details stored from rules page
    const storedPlayerName = localStorage.getItem("playerName");
    const storedEmail = localStorage.getItem("playerEmail");
    const storedCollege = localStorage.getItem("playerCollege");

    function startTimer() {
      startTime = performance.now();
      gameRunning = true;
      timerInterval = setInterval(() => {
        const elapsed = (performance.now() - startTime) / 1000;
        timerEl.textContent = elapsed.toFixed(2);
      }, 50);
    }

    function stopTimer() {
      if (!timerInterval) return 0;
      clearInterval(timerInterval);
      timerInterval = null;
      const elapsed = (performance.now() - startTime) / 1000;
      gameRunning = false;
      return parseFloat(elapsed.toFixed(2));
    }

    async function saveResult(time, finalScore, finalWrongCount) {
      if (!db) {
        throw new Error("Firebase database not initialized");
      }
      
      const now = new Date().toISOString();
      const playerData = {
        name: storedPlayerName || "Unknown",
        email: storedEmail || null,
        college: storedCollege || null,
        time: parseFloat(time) || 0,
        score: parseInt(finalScore) || 0,
        wrongCount: parseInt(finalWrongCount) || 0,
        timestamp: now
      };
      
      console.log("Saving player data:", playerData);
      
      await db.collection("players").add(playerData);
      console.log("Player data saved successfully!");
    }

    function updateLevelUI() {
      // Get elements fresh each time
      const levelName = document.getElementById("level-name");
      const levelProgress = document.getElementById("level-progress");
      const img = document.getElementById("puzzle-image");
      
      // Check if we have valid level
      if (currentLevelIndex < 0 || currentLevelIndex >= LEVELS.length) {
        currentLevelIndex = 0; // Reset to first level if invalid
      }
      
      const level = LEVELS[currentLevelIndex];
      if (!level) {
        console.error("Level not found!");
        return;
      }
      
      // Update level name
      if (levelName) {
        levelName.textContent = level.name;
      }
      
      // Update image
      if (img && level.image) {
        img.src = level.image;
        img.alt = `${level.name} puzzle`;
        img.onerror = function() {
          console.error("Image failed to load:", level.image);
        };
      }
      
      // Update level progress indicator - ALWAYS show all 3 levels
      if (levelProgress) {
        const chips = LEVELS.map((lvl, idx) => {
          let status = "locked";
          if (idx < currentLevelIndex) {
            status = "completed";
          } else if (idx === currentLevelIndex) {
            status = "active";
          }
        return `<span class="level-chip ${status}">${lvl.name}</span>`;
        });
        
        levelProgress.innerHTML = chips.join("");
        levelProgress.style.display = "flex";
        levelProgress.style.visibility = "visible";
        levelProgress.style.opacity = "1";
      }
      
      
      console.log("Level UI updated - Current:", level.name, "All levels:", LEVELS.map(l => l.name).join(", "));
    }

    function clearAnswers() {
      answer1Input.value = "";
      answer2Input.value = "";
      answer3Input.value = "";
      answer4Input.value = "";
    }

    function requestFullscreen() {
      const el = document.documentElement;
      
      // Try different fullscreen methods for browser compatibility
      if (el.requestFullscreen) {
        el.requestFullscreen().then(() => {
          document.body.classList.add('fullscreen-active');
          console.log("Fullscreen entered successfully");
        }).catch((err) => {
          console.log("Fullscreen request failed:", err);
          // Continue anyway - game should work without fullscreen
          document.body.classList.add('fullscreen-active');
        });
      } else if (el.webkitRequestFullscreen) {
        // Safari
        el.webkitRequestFullscreen();
        document.body.classList.add('fullscreen-active');
      } else if (el.mozRequestFullScreen) {
        // Firefox
        el.mozRequestFullScreen();
        document.body.classList.add('fullscreen-active');
      } else if (el.msRequestFullscreen) {
        // IE/Edge
        el.msRequestFullscreen();
        document.body.classList.add('fullscreen-active');
      } else {
        console.log("Fullscreen not supported, continuing without it");
        // Add class anyway so styles still work
        document.body.classList.add('fullscreen-active');
      }
    }

    function exitFullscreen() {
      if (document.fullscreenElement || document.webkitFullscreenElement || 
          document.mozFullScreenElement || document.msFullscreenElement) {
        if (document.exitFullscreen) {
        document.exitFullscreen().then(() => {
          document.body.classList.remove('fullscreen-active');
        }).catch(() => {});
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
          document.body.classList.remove('fullscreen-active');
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
          document.body.classList.remove('fullscreen-active');
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
          document.body.classList.remove('fullscreen-active');
        }
      } else {
        document.body.classList.remove('fullscreen-active');
      }
    }

    // Listen for fullscreen changes (all browser variants)
    function handleFullscreenChange() {
      const isFullscreen = document.fullscreenElement || 
                          document.webkitFullscreenElement || 
                          document.mozFullScreenElement || 
                          document.msFullscreenElement;
      
      if (isFullscreen) {
        document.body.classList.add('fullscreen-active');
      } else {
        document.body.classList.remove('fullscreen-active');

        // If fullscreen was exited unexpectedly while the game is running,
        // and we did NOT explicitly allow it, treat as breaking the rules.
        if (gameRunning && !allowFullscreenExit) {
          disqualifyPlayer();
        }
      }
    }

    // Add listeners for all browser variants
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('mozfullscreenchange', handleFullscreenChange);
    document.addEventListener('MSFullscreenChange', handleFullscreenChange);

    // If the tab loses visibility/focus while the game is running,
    // treat it as breaking the rules (Alt+Tab, switching tabs, etc.)
    document.addEventListener("visibilitychange", () => {
      if (document.hidden && gameRunning) {
        disqualifyPlayer();
      }
    });

    window.addEventListener("blur", () => {
      if (gameRunning) {
        disqualifyPlayer();
      }
    });

    // Global function to start the game - called directly from onclick
    window.startGameNow = function(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      console.log("startGameNow called!");
      
      // Check player details
      if (!storedPlayerName || !storedEmail || !storedCollege) {
        alert("Player details missing. Please start again from the rules page.");
        location.href = "player-rules.html";
        return false;
      }
      
      // Get overlay element
      const overlay = document.getElementById("start-overlay");
      
      // Hide the overlay if it's still visible
      if (overlay && overlay.style.display !== "none") {
        overlay.style.display = "none";
        overlay.style.visibility = "hidden";
        overlay.style.opacity = "0";
        // Remove it from DOM after a moment
        setTimeout(() => {
          if (overlay && overlay.parentNode) {
            try {
              overlay.parentNode.removeChild(overlay);
            } catch(err) {
              console.log("Could not remove overlay:", err);
            }
          }
        }, 100);
      }
      
      console.log("Starting game...");
      
      // Try to enter fullscreen (but don't block if it fails)
      try {
          requestFullscreen();
      } catch (err) {
        console.log("Fullscreen request failed:", err);
        // Continue anyway - game should work without fullscreen
        document.body.classList.add('fullscreen-active');
      }

      // Verify levels are defined
      console.log("Total levels:", LEVELS.length);
      console.log("Levels:", LEVELS.map(l => l.name));
      console.log("Current level index:", currentLevelIndex);
      
      // Reset to first level if needed
      if (currentLevelIndex >= LEVELS.length) {
        currentLevelIndex = 0;
      }
      
      // Update UI - this will show all three levels
      updateLevelUI();
      
      // Force update level progress display
      const levelProgress = document.getElementById("level-progress");
      if (levelProgress) {
        levelProgress.style.display = "flex";
        levelProgress.style.visibility = "visible";
        levelProgress.style.opacity = "1";
        
        // Force render all 3 levels
        if (!levelProgress.innerHTML || levelProgress.innerHTML.trim() === "") {
          const chips = LEVELS.map((lvl, idx) => {
            let status = "locked";
            if (idx < currentLevelIndex) {
              status = "completed";
            } else if (idx === currentLevelIndex) {
              status = "active";
            }
            return `<span class="level-chip ${status}">${lvl.name}</span>`;
          });
          levelProgress.innerHTML = chips.join("");
        }
      }
      
      // Force update image
      const img = document.getElementById("puzzle-image");
      if (img && LEVELS[currentLevelIndex]) {
        img.src = LEVELS[currentLevelIndex].image;
        img.alt = `${LEVELS[currentLevelIndex].name} puzzle`;
      }
      
      // Start the game
      if (msgEl) {
          msgEl.textContent = "Timer started. Solve the puzzle!";
          msgEl.className = "msg";
      }
      
      if (submitBtn) {
          submitBtn.disabled = false;
      }
      
          startTimer();
      
      console.log("Game started successfully! Current level:", LEVELS[currentLevelIndex].name);
      return false;
    };

    // On load, ensure we have player details
    function initGameStart() {
      if (!storedPlayerName || !storedEmail || !storedCollege) {
        alert("Player details missing. Please start again from the rules page.");
        location.href = "player-rules.html";
        return;
      }
      
      // Initialize levels and images immediately
      console.log("Initializing levels...");
      console.log("LEVELS array:", LEVELS);
      updateLevelUI();

      // Also add event listener as backup (in addition to inline onclick)
      const overlay = document.getElementById("start-overlay");
      if (overlay) {
        overlay.addEventListener("click", window.startGameNow);
        overlay.addEventListener("touchstart", window.startGameNow);
        overlay.style.pointerEvents = "auto";
        overlay.style.cursor = "pointer";
        console.log("Start overlay handler attached as backup");
      } else {
        console.error("Start overlay not found!");
      }
    }

    // Initialize when DOM is ready
    function initializeGame() {
      initGameStart();
      // Make sure levels are displayed
      setTimeout(function() {
        updateLevelUI();
      }, 100);
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeGame);
      window.addEventListener('load', initializeGame);
    } else {
      initializeGame();
    }

    submitBtn.addEventListener("click", async () => {
      // Prevent double-submission
      if (isSubmitting) {
        console.log("Already submitting, please wait...");
        return;
      }

      const answers = [
        answer1Input.value.trim().toUpperCase(),
        answer2Input.value.trim().toUpperCase(),
        answer3Input.value.trim().toUpperCase(),
        answer4Input.value.trim().toUpperCase()
      ];

      if (answers.some(a => !a)) {
        msgEl.textContent = "Please fill all 4 answers.";
        msgEl.className = "msg error";
        return;
      }

      if (!gameRunning) {
        msgEl.textContent = "Timer is not running.";
        msgEl.className = "msg error";
        return;
      }

      isSubmitting = true;
      submitBtn.disabled = true;

      const currentLevel = LEVELS[currentLevelIndex];
      const allowedWords = (currentLevel.words || (currentLevel.word ? currentLevel.word.split(",") : []))
        .map(w => w.trim().toUpperCase())
        .filter(Boolean);

      const matches = answers.filter(answer => {
        const normalized = answer.trim().toUpperCase();
        return allowedWords.includes(normalized);
      }).length;
      const misses = answers.length - matches;
      score += matches;
      wrongCount += misses;

      const allowedLabel = allowedWords.join(", ") || "your target list";
      msgEl.textContent = "";
      msgEl.className = "msg";

      const isLastLevel = currentLevelIndex === LEVELS.length - 1;

      try {
      if (!isLastLevel) {
          // Move to next level
        currentLevelIndex += 1;
        clearAnswers();
        updateLevelUI();
          msgEl.textContent = `Level ${currentLevelIndex + 1} of ${LEVELS.length}. Continue!`;
        msgEl.className = "msg success";
          isSubmitting = false;
          submitBtn.disabled = false;
        return;
      }

        // Last level completed - save and redirect
      const time = stopTimer();
        
        console.log("Game completed! Score:", score, "Wrong:", wrongCount, "Time:", time);
        
        msgEl.textContent = `All levels complete! Score: ${score}, Wrong: ${wrongCount}, Time: ${time.toFixed(2)}s. Saving result...`;
      msgEl.className = "msg success";

        console.log("Saving result to Firebase...");
        await saveResult(time, score, wrongCount);
        console.log("Result saved successfully!");
        
        msgEl.textContent = `Result saved! Redirecting to scoreboard...`;
        allowFullscreenExit = true;
        
        // Give user a moment to see the success message
        setTimeout(() => {
          exitFullscreen();
          location.href = "scoreboard.html";
        }, 1500);
      } catch (e) {
        console.error("Error in submit handler:", e);
        msgEl.textContent = "Error: " + (e.message || "Unknown error") + ". Please try again.";
        msgEl.className = "msg error";
        isSubmitting = false;
        submitBtn.disabled = false;
      }
    });

    function quitGame() {
      if (confirm("Quit game and open the scoreboard?")) {
        stopTimer();
        // This is an allowed exit
        allowFullscreenExit = true;
        exitFullscreen();
        location.href = "scoreboard.html";
      }
    }

    // Used when player breaks rules (e.g., presses ESC)
    function disqualifyPlayer() {
      // Prevent this from re-triggering via fullscreenchange
      allowFullscreenExit = true;
      stopTimer();
      exitFullscreen();
      location.href = "disqualified.html";
    }

    // Anti-inspect - block F12, ESC, and developer tools
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    document.addEventListener("keydown", (e) => {
      // If player presses ESC, F5, or refresh shortcuts while the game is running,
      // treat it as breaking the rules (disqualify).
      if (gameRunning) {
        // ESC
        if (e.key === "Escape" || e.keyCode === 27) {
          allowFullscreenExit = false;
          return;
        }
        // F5
        if (e.key === "F5" || e.keyCode === 116) {
          e.preventDefault();
          e.stopPropagation();
          disqualifyPlayer();
          return false;
        }
        // Ctrl+R / Cmd+R (refresh)
        if ((e.ctrlKey || e.metaKey) && (e.key === "r" || e.key === "R")) {
          e.preventDefault();
          e.stopPropagation();
          disqualifyPlayer();
          return false;
        }
      }

      // Always block F12 (console)
      if (e.key === "F12" || e.keyCode === 123) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      
      // Block Ctrl+Shift+I / J / C / K (DevTools shortcuts)
      if (e.ctrlKey && e.shiftKey && ["I","i","J","j","C","c","K","k"].includes(e.key)) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      
      // Block Ctrl+U (View Source) and Ctrl+S (Save Page)
      if (e.ctrlKey && ["U","u","S","s"].includes(e.key)) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    // CROSS-PLATFORM Pinch Zoom for Android & iPhone
    (function() {
      let img = null;
      let scale = 1;
      let translateX = 0;
      let translateY = 0;
      let lastDistance = 0;
      let lastScale = 1;
      let lastTranslateX = 0;
      let lastTranslateY = 0;
      let isPinching = false;
      let isDragging = false;
      let dragStartX = 0;
      let dragStartY = 0;
      
      function getDistance(t1, t2) {
        const dx = t2.clientX - t1.clientX;
        const dy = t2.clientY - t1.clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }
      
      function applyTransform() {
        if (!img) return;
        img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        img.style.transformOrigin = 'center center';
        img.style.transition = 'none';
      }
      
      function handleTouchStart(e) {
        if (!img) return;
        
        const touches = e.touches;
        
        if (touches.length === 2) {
          // TWO FINGERS - START PINCH
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          isPinching = true;
          isDragging = false;
          
          const t1 = touches[0];
          const t2 = touches[1];
          
          lastDistance = getDistance(t1, t2);
          lastScale = scale;
          lastTranslateX = translateX;
          lastTranslateY = translateY;
          
          // Get image center
          const rect = img.getBoundingClientRect();
          const imgCenterX = rect.left + rect.width / 2;
          const imgCenterY = rect.top + rect.height / 2;
          
          // Store pinch center relative to image
          const pinchCenterX = (t1.clientX + t2.clientX) / 2;
          const pinchCenterY = (t1.clientY + t2.clientY) / 2;
          
          dragStartX = pinchCenterX - imgCenterX;
          dragStartY = pinchCenterY - imgCenterY;
          
        } else if (touches.length === 1 && scale > 1) {
          // ONE FINGER - START DRAG
          e.preventDefault();
          e.stopPropagation();
          
          isDragging = true;
          isPinching = false;
          
          const t = touches[0];
          dragStartX = t.clientX - translateX;
          dragStartY = t.clientY - translateY;
        }
      }
      
      function handleTouchMove(e) {
        if (!img) return;
        
        const touches = e.touches;
        
        if (touches.length === 2 && isPinching) {
          // TWO FINGERS - PINCH TO ZOOM
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          const t1 = touches[0];
          const t2 = touches[1];
          const currentDistance = getDistance(t1, t2);
          
          if (lastDistance > 0) {
            // Calculate new scale
            const newScale = lastScale * (currentDistance / lastDistance);
            scale = Math.max(1, Math.min(4, newScale));
            
            // Get current pinch center
            const rect = img.getBoundingClientRect();
            const imgCenterX = rect.left + rect.width / 2;
            const imgCenterY = rect.top + rect.height / 2;
            
            const pinchCenterX = (t1.clientX + t2.clientX) / 2;
            const pinchCenterY = (t1.clientY + t2.clientY) / 2;
            
            // Calculate offset from image center
            const offsetX = pinchCenterX - imgCenterX;
            const offsetY = pinchCenterY - imgCenterY;
            
            // Adjust translate to keep pinch center fixed
            const scaleChange = scale / lastScale;
            translateX = lastTranslateX + (offsetX - dragStartX) * (1 - scaleChange);
            translateY = lastTranslateY + (offsetY - dragStartY) * (1 - scaleChange);
            
            applyTransform();
          }
          
        } else if (touches.length === 1 && isDragging && scale > 1) {
          // ONE FINGER - DRAG
          e.preventDefault();
          e.stopPropagation();
          
          const t = touches[0];
          translateX = t.clientX - dragStartX;
          translateY = t.clientY - dragStartY;
          
          applyTransform();
        }
      }
      
      function handleTouchEnd(e) {
        if (!img) return;
        
        const touches = e.touches;
        
        if (touches.length === 0) {
          isPinching = false;
          isDragging = false;
          lastDistance = 0;
        } else if (touches.length === 1 && isPinching) {
          // One finger remains - switch to drag
          isPinching = false;
          if (scale > 1) {
            isDragging = true;
            const t = touches[0];
            dragStartX = t.clientX - translateX;
            dragStartY = t.clientY - translateY;
          }
        }
      }
      
      function initPinchZoom() {
        img = document.getElementById('puzzle-image');
        
        if (!img) {
          setTimeout(initPinchZoom, 100);
          return;
        }
        
        // Set CSS properties
        img.style.touchAction = 'none';
        img.style.webkitTouchCallout = 'none';
        img.style.userSelect = 'none';
        img.style.webkitUserSelect = 'none';
        
        // Remove any existing listeners by using a unique handler
        const container = img.parentElement;
        
        // Attach to image
        img.addEventListener('touchstart', handleTouchStart, { passive: false, capture: true });
        img.addEventListener('touchmove', handleTouchMove, { passive: false, capture: true });
        img.addEventListener('touchend', handleTouchEnd, { passive: false, capture: true });
        img.addEventListener('touchcancel', handleTouchEnd, { passive: false, capture: true });
        
        // Also attach to container
        if (container) {
          container.addEventListener('touchstart', handleTouchStart, { passive: false, capture: true });
          container.addEventListener('touchmove', handleTouchMove, { passive: false, capture: true });
          container.addEventListener('touchend', handleTouchEnd, { passive: false, capture: true });
        }
        
        // Reset zoom when image changes
        const origUpdate = window.updateLevelUI;
        if (typeof origUpdate === 'function') {
          window.updateLevelUI = function() {
            origUpdate();
            scale = 1;
            translateX = 0;
            translateY = 0;
            if (img) {
              img.style.transform = 'scale(1)';
            }
          };
        }
        
        // Add visual feedback on first touch
        let touchCount = 0;
        img.addEventListener('touchstart', function() {
          touchCount++;
          if (touchCount === 1) {
            console.log(' Touch detected! Pinch zoom is active.');
            // Brief visual feedback
            img.style.opacity = '0.95';
            setTimeout(() => {
              if (img) img.style.opacity = '1';
            }, 200);
          }
        }, { once: false, passive: true });
        
        console.log(' Pinch zoom initialized for Android & iPhone');
        console.log(' Try pinching with 2 fingers on the image!');
      }
      
      // Initialize
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initPinchZoom);
        window.addEventListener('load', initPinchZoom);
      } else {
        initPinchZoom();
      }
      
      // Also try after a delay
      setTimeout(initPinchZoom, 500);
      
      // Final attempt after image loads
      window.addEventListener('load', function() {
        setTimeout(initPinchZoom, 1000);
      });
      
    })();
  </script>
</body>
</html>
